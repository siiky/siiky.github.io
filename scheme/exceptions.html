<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="siiky" />
  <title>Exceptions (aka Conditions) in Scheme</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    q { quotes: "“" "”" "‘" "’"; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
body {
background-color:#101010;
color:#FD971F;
font-family:monospace;
font-size:15px;

}
h1,h2,h3,h4,h5,h6 {
color:#A6E22E;
text-decoration:bold;
}
h1 { font-size:21px; }
h2 { font-size:20px; }
h3 { font-size:19px; }
h4 { font-size:18px; }
h5 { font-size:17px; }
h6 { font-size:16px; }
a {
color:#66D9EF;
text-decoration:none
}
a:visited {
color:#A6E22E
}
a:hover {
background-color:#66D9EF;
color:#101010;
text-decoration:underline
}
</style>
</head>
<body>
<h1 id="nothing-interesting-here">nothing interesting here</h1>
<header id="title-block-header">
<h1 class="title">Exceptions (aka Conditions) in Scheme</h1>
<p class="author">siiky</p>
<p class="date">2019/08/13</p>
</header>
<p><strong>DISCLAIMER</strong>: I’m not a very advanced Schemer, and conditions in Scheme are especially confusing to me. Please excuse any possibly wrong terminology or claims. If you have any comments, shoot me a message.</p>
<p>Exceptions are (in general) very weird things, but even more so in Scheme. I have little (close to none) experience with them, and the little that I have was attained from need (i.e., <q>works? great!</q>).</p>
<h1 data-number="1" id="conditions"><span class="header-section-number">1</span> Conditions</h1>
<p>Conditions are objects that represent an exception (like instances of a subclass of <code class="sourceCode java"><span class="bu">Exception</span></code> in Java, maybe?), and in Scheme you can use them just like any other object. You can create one, pass it around, and not even throw it. It’s also possible to throw non-condition objects (maybe for non-local or early return?).</p>
<h1 data-number="2" id="exception-handling"><span class="header-section-number">2</span> Exception Handling</h1>
<h2 data-number="2.1" id="catching"><span class="header-section-number">2.1</span> Catching</h2>
<p>A neat way to <em>catch</em> exceptions is with <a href="https://api.call-cc.org/5/doc/chicken/condition/condition-case"><code class="sourceCode scheme">condition-case</code></a>. You give it an expression to evaluate, give it the kinds of exceptions you are expecting and how to deal with them, and voila:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scm"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">; General usage</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>(condition-case expression</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>  ((kind1 kind2) (print <span class="st">&quot;kind1 kind2&quot;</span>) ...)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  ((kind) (print <span class="st">&quot;kind&quot;</span>) ...)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  <span class="co">; con needn&#39;t be a condition</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  (con () (print <span class="st">&quot;some other kind: &quot;</span> con) ...))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co">; Concrete example</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>(condition-case</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  (<span class="kw">begin</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    (print <span class="st">&quot;This is part of the expression&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    (<span class="kw">car</span> (<span class="op">/</span> <span class="dv">42</span> <span class="dv">0</span>)))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>  ((exn type)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    (print <span class="st">&quot;Wrong type&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>    <span class="dv">#f</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>  ((exn arithmetic)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>    (print <span class="st">&quot;Some arithmetic error&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>    <span class="dv">0</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>  (con ()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>    (print con <span class="st">&quot; ¯</span><span class="ch">\\</span><span class="st">_(ツ)_/¯&quot;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>    con))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a><span class="co">;; prints:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="co">;; This is part of the expression</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a><span class="co">;; Some arithmetic error</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a><span class="co">;; =&gt; 0</span></span></code></pre></div>
<p>If no exception is thrown when evaluating the expression, the value of the <code class="sourceCode scheme">condition-case</code> block is that of the expression. If an exception is thrown, then the value is that of the last of the expressions associated with the first matching branch. If there is no matching branch, the exception is propagated, until a handler for it is found (or none, in which case the program crashes).</p>
<p>The condition cases should be ordered from more specific to less specific. For example, a condition of kind <code class="sourceCode scheme">(exn type)</code> is also of kind <code class="sourceCode scheme">(exn)</code>, so the former should be above the latter.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scm"><code class="sourceCode scheme"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>(condition-case (<span class="kw">car</span> &#39;some-val)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>  ((exn)      (print <span class="st">&quot;Wrong type&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  ((exn type) (print <span class="st">&quot;This will never happen&quot;</span>)))</span></code></pre></div>
<h2 data-number="2.2" id="throwing"><span class="header-section-number">2.2</span> Throwing</h2>
<p>If you want to throw something, use <a href="https://api.call-cc.org/5/doc/chicken/condition/signal"><code class="sourceCode scheme">signal</code></a>. There are also <a href="https://api.call-cc.org/5/doc/chicken/condition/abort"><code class="sourceCode scheme">abort</code></a> and <a href="https://api.call-cc.org/5/doc/srfi-18/raise"><code class="sourceCode scheme">raise</code></a>, but I don’t know why/when one should use them. In CHICKEN, <a href="https://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a>’s <code class="sourceCode scheme">raise</code> is just <code class="sourceCode scheme">signal</code>, but this may change in the future and might not even be the case in other implementations.</p>
<h1 data-number="3" id="related-topics-of-interest"><span class="header-section-number">3</span> Related Topics of Interest</h1>
<ul>
<li>Continuable and non-continuable exceptions;</li>
<li>How is all this implemented?</li>
<li>How to make a condition and how to get things out of a condition object.</li>
</ul>
<div class="line-block">places:<br />
<a href="https://siiky.github.io">Go home!</a><br />
<a href="https://github.com/siiky">GitHub</a><br />
<a href="https://siiky.github.io/atom.xml">Atom Feed</a></div>
</body>
</html>
