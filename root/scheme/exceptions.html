<p><strong>DISCLAIMER</strong>: I’m not a very advanced Schemer, and
conditions in Scheme are especially confusing to me. Please excuse any
possibly wrong terminology or claims. If you have any comments, shoot me
a message.</p>
<p>Exceptions are (in general) very weird things, but even more so in
Scheme. I have little (close to none) experience with them, and the
little that I have was attained from need (i.e., “works? great!”).</p>
<h1 id="conditions">Conditions</h1>
<p>Conditions are objects that represent an exception (like instances of
a subclass of <code
class="sourceCode java"><span class="bu">Exception</span></code> in
Java, maybe?), and in Scheme you can use them just like any other
object. You can create one, pass it around, and not even throw it. It’s
also possible to throw non-condition objects (maybe for non-local or
early return?).</p>
<h1 id="exception-handling">Exception Handling</h1>
<h2 id="catching">Catching</h2>
<p>A neat way to <em>catch</em> exceptions is with <a
href="https://api.call-cc.org/5/doc/chicken/condition/condition-case"><code
class="sourceCode scheme">condition-case</code></a>. You give it an
expression to evaluate, give it the kinds of exceptions you are
expecting and how to deal with them, and voila:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode scm"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">; General usage</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(condition-case expression</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  ((kind1 kind2) (print <span class="st">&quot;kind1 kind2&quot;</span>) <span class="op">...</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ((kind) (print <span class="st">&quot;kind&quot;</span>) <span class="op">...</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">; con needn&#39;t be a condition</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  (con () (print <span class="st">&quot;some other kind: &quot;</span> con) <span class="op">...</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">; Concrete example</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>(condition-case</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">begin</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    (print <span class="st">&quot;This is part of the expression&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">car</span> (<span class="op">/</span> <span class="dv">42</span> <span class="dv">0</span>)))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  ((exn type)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    (print <span class="st">&quot;Wrong type&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">#f</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  ((exn arithmetic)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    (print <span class="st">&quot;Some arithmetic error&quot;</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  (con ()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    (print con <span class="st">&quot; ¯</span><span class="ch">\\</span><span class="st">_(ツ)_/¯&quot;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    con))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">;; prints:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">;; This is part of the expression</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">;; Some arithmetic error</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">;; =&gt; 0</span></span></code></pre></div>
<p>If no exception is thrown when evaluating the expression, the value
of the <code class="sourceCode scheme">condition-case</code> block is
that of the expression. If an exception is thrown, then the value is
that of the last of the expressions associated with the first matching
branch. If there is no matching branch, the exception is propagated,
until a handler for it is found (or none, in which case the program
crashes).</p>
<p>The condition cases should be ordered from more specific to less
specific. For example, a condition of kind <code
class="sourceCode scheme">(exn type)</code> is also of kind <code
class="sourceCode scheme">(exn)</code>, so the former should be above
the latter.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode scm"><code class="sourceCode scheme"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(condition-case (<span class="kw">car</span> &#39;some-val)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  ((exn)      (print <span class="st">&quot;Wrong type&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  ((exn type) (print <span class="st">&quot;This will never happen&quot;</span>)))</span></code></pre></div>
<h2 id="throwing">Throwing</h2>
<p>If you want to throw something, use <a
href="https://api.call-cc.org/5/doc/chicken/condition/signal"><code
class="sourceCode scheme">signal</code></a>. There are also <a
href="https://api.call-cc.org/5/doc/chicken/condition/abort"><code
class="sourceCode scheme">abort</code></a> and <a
href="https://api.call-cc.org/5/doc/srfi-18/raise"><code
class="sourceCode scheme"><span class="kw">raise</span></code></a>, but
I don’t know why/when one should use them. In CHICKEN, <a
href="https://srfi.schemers.org/srfi-18/srfi-18.html">SRFI-18</a>’s
<code class="sourceCode scheme"><span class="kw">raise</span></code> is
just <code class="sourceCode scheme">signal</code>, but this may change
in the future and might not even be the case in other
implementations.</p>
<h1 id="related-topics-of-interest">Related Topics of Interest</h1>
<ul>
<li>Continuable and non-continuable exceptions;</li>
<li>How is all this implemented?</li>
<li>How to make a condition and how to get things out of a condition
object.</li>
</ul>
